# 🚌 Τηλεματική ΟΑΣΑ – Server

Το παρόν project αποτελεί το **Πρακτικό μέρος** της διπλωματικής με θέμα **Τηλεματική Λεvφoρείων με Χρήση τεχνιτής νοημασύνης** .  
Σκοπός του είναι η συλλογή, επεξεργασία και διάθεση δεδομένων σε πραγματικό χρόνο που αφορούν:
- Θέσεις λεωφορείων
- Χρόνους αναμονής στις στάσεις
- Δρομολόγια και χρονοδιαγράμματα
- Προτάσεις προσθήκης ή αφαίρεσης δρομολογίων
- Προτάσεις προς τον διαχειρηστή για αύξηση ή μειώση δρομολογίων

---

## 📖 Περιεχόμενα
- [Οδηγείες για το Kubernetes Cluster](#οδηγείες-για-το-kubernetes-cluster)
- [Δημιουργία βάσης δεδομένων](#δημιουργία-βάσης-δεδομένων)
- [Δημιουργία Authendicator Server](#δημιουργία-authendicator-server)
- [Δημιουργία Application Server](#δημιουργία-application-server)
- [Δημιουργία OTP Server](#δημιουργία-otp-server)
- [Δημιουργία Cronjob](#δημιουργία-cronjob)
- [Δημιουργία Admin Portal](#δημιουργία-admin-portal)
- [Δημιοργία Mobile Εφαρμογή](#δημιοργία-mobile-εφαρμογή)


## Οδηγείες για το Kubernetes Cluster
Στον Cluster γίνονται deploy όλες οι εφαρμογές που αφορούν το backend. Αυτές είναι η βάση δεδομένων, ο Application Server, ο Authendicator Server και το CronJob που συγχρονίζει τα δεδομένα. Επομένως πως μπορούμε να εκτελέσουμε όλα αυτά στον Cluster με μία σειρά εντολών. 
Πρώτα πρέπει να δημειουργηθεί η βάση δεδομένων και μετά όλα τα υπολοιπα. Αυτό γιατί όλα χρησιμοποιούν την βάση δεδομένων, σε περιπτωση που γίνουν με άλλη σειρά δεν υπάρχει κάποιο πρόβλημα γιατί έχουν σχεδιαστεί όλα με τέτοιο τρόπο ώστε να περίμένουν μέχρι όλες οι εξαρτήσεις είναι έτοιμες.

Εδώ κάνουμε δημιουργία το Namespace που θα στήσουμε μέσα σε αυτό όλα τα παραπάνω. 
    
**Θυμίζουμε ότι το namespace είναι είναι ένας λογικός διαχωρισμός πόρων σε απομονομένα σύνολα ώστε να οργανόνονται, να διαχειρίζονται και να ελέγχονται πιο ευκκολα.

```
kubectl create namespace oasa-telemat
```

### Δημιουργία βάσης δεδομένων
```
cd monorepo_internal
kubectl apply -k kube/mysql
```

### Δημιουργία Authendicator Server
```
kubectl apply -k kube/keycloak
```
Μετά την δημιοργία του της εφαρμογής του Authendicator θα πρέπει να γίνου ενεργείες στο διαχειριστικό του.

- Κάνουμε login με τα Credentials του διαχειριστή
- Πατάμε πάνω αριστερά, σε ένα Dropdown για να δημιουργήσουμε ένα νέο relame
    ![Δημιοργία νέου Realme](./assets/image_1.png)
- Αφού δημιοργήσουμε το realm θα πρέπεί να κάνουμε αλλαγή στο realm και να δημιουργήσουμε ένα Client-id.
    ![Δημιοργία νέου Client-id](./assets/image_2.png)
    ![Έναρξη Δημιοργίας νέου Client-id](./assets/image_3.png)
    ![Έπόμενο βήμα Δημιοργίας νέου Client-id](./assets/image_4.png)
    ![Έπόμενο βήμα Δημιοργίας νέου Client-id](./assets/image_5.png)
    ![Τέλος Δημιοργίας νέου Client-id](./assets/image_6.png)
- Θα πρέπει να δημιουργήσουμε και ένα test χειριστή που θα χρησιμοποιήσουμε. Η δημιουργία του χειριστή θα γίνει ακολουθώντας τα παρακάτω βήματα
![Δημιοργία νέου χειριστή](./assets/image_7.png)
![Επόμενο βήμα δημιουργίας χειριστή](./assets/image_8.png)
![Τέλος δημιουργίας χειριστή](./assets/image_9.png)

### Δημιουργία Application Server
1) Εφόσον κάνουμε Build το Docker image 

```
docker build -f docker/oasa-api.Dockerfile -t localhost:5000/oasa-api:0.0.1 --network=host .
```

2) Με την χρήση Kustomization θα κάνουμε Depoloy την εφαρμογη και ότι άλλο χρειάζεται.
```
kubectl apply -k kube/server
```
### Δημιουργία OTP Server
1) Θα πρέπει να κάνουμε Build το Docker image με την παρακάτω εντολή.
```
docker build -f docker/trip-planner-api.Dockerfile -t localhost:5000/trip-planner-api:0.0.8 --network=host .
```
2) Να κάνω Deploy την εφαρμογή στο Cluster δημιουργώντας και ότι άλλο χρειάζεται χρησιμοποιώντας Kustomization.

```
kubectl apply -k kube/open-trip-planer/
```
### Δημιουργία Cronjob

1) Πρέπει να κάνουμε Build το Docker Image

```
docker build -f docker/oasa-job.Dockerfile -t localhost:5000/oasa-job:0.0.1 --network=host .
```

2) Μετά πρέπει να κάνουμε deploy το Cronjob στον Cluster. Με την χρήση Kustomization θα δημιουργήσουμε το CornJob και ότι άλλο χρειάζεται

```
kubectl apply -k kube/cronjob
```



### Δημιουργία Admin Portal
Είναι μία Web Εφαρμογή με την οποία ο διαχειρηστής του οργανισμού μεταφορών μπορεί να δει πληροφορίες αλλά και να κάνει ενέργει εκ των οποίων είναι η αποστολή ειδοποιήσεων στους χειριστές της Mobile εφαρμογής αλλά και η προσθήκη ή μειώση δρομολογίου ανάλογα με τις προτάσεις του συστήματος.

Για την εκτέλεση της εφαρμογής

1) Θα πρέπει να κάνουμε build to Docker Image

``` 
cd admin-bus
docker build -f docker\portal.Dcoekrfile - t cs161079/portal-admin:0.0.1 .
docker push cs161079/portal-admin:0.0.1
```
 2) Θα κάνουμε deploy την εφαρμογή με την χρήση του Kustomization
 ```
  kubectl apply -k kube
 ```

## Δημιοργία Mobile Εφαρμογή
Είναι μία εφαρμογή για τα κινητά android η οποία δημιουργήθηκε για να βελτιώσει την εμπειρία των επιβατών με τα μέσα μαζικής μεταφοράς. Με αυτή την εφαρμογή ο επιβάτεις μπορεί να δεί πληροφορίες για την τοποθεσία των λωφορείων ανά πάσα στιγμή, όπως ακομά και πληρότητα των λεωφορείων σε επιβάτες. Τέλος μπορεί να σχεδίασει την διαδρομή από το σημείο εκκίνησης στο σημείο προορισμού κάνοντας χρήση των ΜΜΜ και πεζά τμήματα.

Για την δημιουργία του APK πρέπει

1) Προετοιμασία του project για άνοιγμα με το Android Studio και build του APK
```
cd bus-telematic-android
npm install
ionic cap sync
```

2) Άνοιγμα του /android καταλόγού με το Android Studio, κάνουμε build την εφαρμογή και παράγεται το APK.

